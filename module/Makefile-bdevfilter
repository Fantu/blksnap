# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2023 Veeam Software Group GmbH
# Additions for standalone bdevfilter module

EXTRA_CFLAGS += "-Wno-unused-function"

EXTRA_CFLAGS += $(shell 							\
	grep -qw "TSK_TRACE_FL_TRACE_BIT" $(srctree)/include/linux/ftrace.h &&	\
		echo -D HAVE_NOT_FTRACE_FREE_FILTER)
EXTRA_CFLAGS += $(shell test -f $(srctree)/include/linux/blkdev.h &&		\
	grep -qw "void bdev_mark_dead" $(srctree)/include/linux/blkdev.h && \
		echo -D HAVE_BDEV_MARK_DEAD)

obj-m	 += bdevfilter.o
